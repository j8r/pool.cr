crystal_doc_search_index_callback({"repository_name":"pool","body":"# Pool.cr\n\n[![CI](https://github.com/j8r/pool.cr/workflows/CI/badge.svg)](https://github.com/j8r/pool.cr/actions?query=workflow%3ACI)\n[![Documentation](https://github.com/j8r/pool.cr/workflows/Documentation/badge.svg)](https://j8r.github.io/pool.cr)\n[![ISC](https://img.shields.io/badge/License-ISC-blue.svg?style=flat-square)](https://en.wikipedia.org/wiki/ISC_license)\n\nA simple thread-safe generic pool.\n\nA pool can be used to store objects that are expensive to create (like connections).\n[See here](https://en.wikipedia.org/wiki/Pool_(computer_science)) for more explanations.\n\n## Installation\n\nAdd the dependency to your `shard.yml`:\n\n```yaml\ndependencies:\n  pool:\n    github: j8r/pool.cr\n```\n\n## Documentation\n\nhttps://j8r.github.io/pool.cr\n\n## Usage\n\n```cr\nrequire \"pool\"\n\npool = Pool.new { IO::Memory.new }\npool.get do |resource|\n  # do something\nend\n```\n\n## License\n\nCopyright (c) 2021 Julien Reichardt - ISC License\n","program":{"html_id":"pool/toplevel","path":"toplevel.html","kind":"module","full_name":"Top Level Namespace","name":"Top Level Namespace","abstract":false,"superclass":null,"ancestors":[],"locations":[],"repository_name":"pool","program":true,"enum":false,"alias":false,"aliased":"","const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":null,"doc":null,"summary":null,"class_methods":[],"constructors":[],"instance_methods":[],"macros":[],"types":[{"html_id":"pool/Pool","path":"Pool.html","kind":"class","full_name":"Pool(T)","name":"Pool","abstract":false,"superclass":{"html_id":"pool/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"pool/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"pool/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"src/pool.cr","line_number":14,"url":"https://github.com/j8r/pool.cr/blob/c5c68b1478afd6d86046b77528ea80159b85e290/src/pool.cr#L14"}],"repository_name":"pool","program":false,"enum":false,"alias":false,"aliased":"","const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":null,"doc":"A simple thread-safe generic pool.\n\nA pool can be used to store resources that are expensive to create (like connections).\n[See here](https://en.wikipedia.org/wiki/Pool_(computer_science)) for more explanations.\n\n```\nrequire \"pool\"\n\npool = Pool.new { IO::Memory.new }\npool.get do |resource|\n  # do something\nend\n```","summary":"<p>A simple thread-safe generic pool.</p>","class_methods":[],"constructors":[{"id":"new(initial_capacity:Int=0,&block:->T)-class-method","html_id":"new(initial_capacity:Int=0,&block:->T)-class-method","name":"new","doc":"Creates a new Pool.\n\n```\nrequire \"pool\"\n\nPool.new { IO::Memory.new }\n```","summary":"<p>Creates a new Pool.</p>","abstract":false,"args":[{"name":"initial_capacity","doc":null,"default_value":"0","external_name":"initial_capacity","restriction":"Int"}],"args_string":"(initial_capacity : Int = <span class=\"n\">0</span>, &block :  -> T)","source_link":"https://github.com/j8r/pool.cr/blob/c5c68b1478afd6d86046b77528ea80159b85e290/src/pool.cr#L39","def":{"name":"new","args":[{"name":"initial_capacity","doc":null,"default_value":"0","external_name":"initial_capacity","restriction":"Int"}],"double_splat":null,"splat_index":null,"yields":0,"block_arg":{"name":"block","doc":null,"default_value":"","external_name":"block","restriction":"(-> T)"},"return_type":"","visibility":"Public","body":"_ = Pool(T).allocate\n_.initialize(initial_capacity, &block) do\n  yield\nend\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"}}],"instance_methods":[{"id":"add(resource:T):Nil-instance-method","html_id":"add(resource:T):Nil-instance-method","name":"add","doc":"Adds a resource.","summary":"<p>Adds a resource.</p>","abstract":false,"args":[{"name":"resource","doc":null,"default_value":"","external_name":"resource","restriction":"T"}],"args_string":"(resource : T) : Nil","source_link":"https://github.com/j8r/pool.cr/blob/c5c68b1478afd6d86046b77528ea80159b85e290/src/pool.cr#L45","def":{"name":"add","args":[{"name":"resource","doc":null,"default_value":"","external_name":"resource","restriction":"T"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"Nil","visibility":"Public","body":"synchronize do\n  @idle_resources.push(resource)\nend"}},{"id":"get:T-instance-method","html_id":"get:T-instance-method","name":"get","doc":"Gets a resource.","summary":"<p>Gets a resource.</p>","abstract":false,"args":[],"args_string":" : T","source_link":"https://github.com/j8r/pool.cr/blob/c5c68b1478afd6d86046b77528ea80159b85e290/src/pool.cr#L56","def":{"name":"get","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"T","visibility":"Public","body":"synchronize do\n  @idle_resources.shift? || new_resource\nend"}},{"id":"get(&:T->):Nil-instance-method","html_id":"get(&:T->):Nil-instance-method","name":"get","doc":"Gets an resource, yields, then adds it back.\n\nNote that if an exception was raised in the block, the resource won't be added back.\nThis behavior is used to prevent adding an invalid resource, for example a connection causing an IO error.","summary":"<p>Gets an resource, yields, then adds it back.</p>","abstract":false,"args":[],"args_string":"(& : T -> ) : Nil","source_link":"https://github.com/j8r/pool.cr/blob/c5c68b1478afd6d86046b77528ea80159b85e290/src/pool.cr#L64","def":{"name":"get","args":[],"double_splat":null,"splat_index":null,"yields":1,"block_arg":{"name":"","doc":null,"default_value":"","external_name":"","restriction":"(T -> )"},"return_type":"Nil","visibility":"Public","body":"resource = get\nbegin\n  yield resource\nrescue ex\n  @total_resources.delete(resource)\n  raise(ex)\nelse\n  add(resource)\nend\n"}},{"id":"idle_size:Int32-instance-method","html_id":"idle_size:Int32-instance-method","name":"idle_size","doc":"Returns the pool's idle size.","summary":"<p>Returns the pool's idle size.</p>","abstract":false,"args":[],"args_string":" : Int32","source_link":"https://github.com/j8r/pool.cr/blob/c5c68b1478afd6d86046b77528ea80159b85e290/src/pool.cr#L82","def":{"name":"idle_size","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"Int32","visibility":"Public","body":"@idle_resources.size"}},{"id":"resize(new_size:Int32,&:T->):Nil-instance-method","html_id":"resize(new_size:Int32,&:T->):Nil-instance-method","name":"resize","doc":"Resizes the pool to match the new `total_size`, and yields each deleted resource on size shrinking.","summary":"<p>Resizes the pool to match the new <code><a href=\"Pool.html#total_size:Int32-instance-method\">#total_size</a></code>, and yields each deleted resource on size shrinking.</p>","abstract":false,"args":[{"name":"new_size","doc":null,"default_value":"","external_name":"new_size","restriction":"Int32"}],"args_string":"(new_size : Int32, & : T -> ) : Nil","source_link":"https://github.com/j8r/pool.cr/blob/c5c68b1478afd6d86046b77528ea80159b85e290/src/pool.cr#L92","def":{"name":"resize","args":[{"name":"new_size","doc":null,"default_value":"","external_name":"new_size","restriction":"Int32"}],"double_splat":null,"splat_index":null,"yields":1,"block_arg":{"name":"","doc":null,"default_value":"","external_name":"","restriction":"(T -> )"},"return_type":"Nil","visibility":"Public","body":"case total_size\nwhen  < new_size\n  synchronize do\n    while total_size < new_size\n      @idle_resources.push(new_resource)\n    end\n  end\nwhen  > new_size\n  synchronize do\n    while total_size > new_size\n      resource = @idle_resources.shift\n      @total_resources.delete(resource)\n      yield resource\n    end\n  end\nend"}},{"id":"resize(new_size:Int32):Nil-instance-method","html_id":"resize(new_size:Int32):Nil-instance-method","name":"resize","doc":"Resizes the pool to match the new size","summary":"<p>Resizes the pool to match the new size</p>","abstract":false,"args":[{"name":"new_size","doc":null,"default_value":"","external_name":"new_size","restriction":"Int32"}],"args_string":"(new_size : Int32) : Nil","source_link":"https://github.com/j8r/pool.cr/blob/c5c68b1478afd6d86046b77528ea80159b85e290/src/pool.cr#L112","def":{"name":"resize","args":[{"name":"new_size","doc":null,"default_value":"","external_name":"new_size","restriction":"Int32"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"Nil","visibility":"Public","body":"resize(new_size) do\nend"}},{"id":"total_size:Int32-instance-method","html_id":"total_size:Int32-instance-method","name":"total_size","doc":"Returns the pool's total size.","summary":"<p>Returns the pool's total size.</p>","abstract":false,"args":[],"args_string":" : Int32","source_link":"https://github.com/j8r/pool.cr/blob/c5c68b1478afd6d86046b77528ea80159b85e290/src/pool.cr#L87","def":{"name":"total_size","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"Int32","visibility":"Public","body":"@total_resources.size"}},{"id":"used_size:Int32-instance-method","html_id":"used_size:Int32-instance-method","name":"used_size","doc":"Returns the pool's used resources size.","summary":"<p>Returns the pool's used resources size.</p>","abstract":false,"args":[],"args_string":" : Int32","source_link":"https://github.com/j8r/pool.cr/blob/c5c68b1478afd6d86046b77528ea80159b85e290/src/pool.cr#L77","def":{"name":"used_size","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"Int32","visibility":"Public","body":"total_size - idle_size"}}],"macros":[],"types":[]}]}})